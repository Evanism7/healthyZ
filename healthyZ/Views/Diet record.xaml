<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:chart="clr-namespace:Syncfusion.Maui.Charts;assembly=Syncfusion.Maui.Charts"
             x:Class="healthy.Views.Diet_record"
             Title="飲食紀錄"
             BackgroundColor="#D5E8D4">

    <ScrollView>
        <StackLayout Padding="10">
            <VerticalStackLayout Padding="10" Spacing="10">
                <Label Text="選擇期間" FontAttributes="Bold" TextColor="Black" />

                <HorizontalStackLayout Spacing="10">
                    <DatePicker x:Name="StartDatePicker" TextColor="Black" />
                    <DatePicker x:Name="EndDatePicker" TextColor="Black" />
                    <Button Text="分析" Clicked="OnAnalyzeClicked" />
                </HorizontalStackLayout>

                <Label x:Name="TotalCaloriesLabel"
                       Text="總熱量: 0 kcal"
                       FontSize="20"
                       TextColor="Black"
                       FontAttributes="Bold"
                       HorizontalOptions="Center" />

                <!-- 圓餅圖 -->
                <chart:SfCircularChart x:Name="NutritionChart"
                                       HeightRequest="250"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center">
                    <chart:SfCircularChart.Legend>
                        <chart:ChartLegend IsVisible="True" Placement="Bottom"/>
                    </chart:SfCircularChart.Legend>

                    <chart:PieSeries ItemsSource="{Binding NutritionData}"
                                     XBindingPath="Category"
                                     YBindingPath="Value"
                                     ShowDataLabels="True" />
                </chart:SfCircularChart>
            </VerticalStackLayout>

            <!-- ✅ 每兩筆一排的 CollectionView -->
            <CollectionView x:Name="notesCollectionView"
                            Margin="0,10,0,10">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" Span="2" />
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Margin="5"
                               BackgroundColor="#A5D6A7"
                               CornerRadius="12"
                               Padding="10"
                               HasShadow="True">
                            <VerticalStackLayout Spacing="3">
                                <Label Text="{Binding food_name}"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="Black" />
                                <Label Text="{Binding calories, StringFormat='熱量: {0} kcal'}" FontSize="14" />
                                <Label Text="{Binding carbohydrates, StringFormat='碳水: {0} g'}" FontSize="14" />
                                <Label Text="{Binding protein, StringFormat='蛋白質: {0} g'}" FontSize="14" />
                                <Label Text="{Binding fat, StringFormat='脂肪: {0} g'}" FontSize="14" />
                                <Label Text="{Binding Weight, StringFormat='重量: {0} g'}" FontSize="14" />
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </StackLayout>
    </ScrollView>
</ContentPage>
